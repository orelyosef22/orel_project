<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>×ª×•×¦××•×ª ×”×¡×™××•×œ×¦×™×”</title>
  <link rel="stylesheet" href="css/style.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
  <style>
    .custom-table {
  width: 70%;               /* ×”×˜×‘×œ×” ×ª×•×¤×¡×ª 70% ××¨×•×—×‘ ×”×¢××•×“ */
  margin: 20px auto;        /* ×¨×•×•×— ×¢×œ×™×•×Ÿ/×ª×—×ª×•×Ÿ ×©×œ 20px ×•××¨×›×•×– ××•×¤×§×™ */
}

.custom-table th, .custom-table td {
  border: 1px solid #000;   /* ××¡×’×¨×ª ×©×—×•×¨×” ×‘×¢×•×‘×™ 1 ×¤×™×§×¡×œ ×œ×›×œ ×ª× ×‘×˜×‘×œ×” */
  padding: 12px 15px;       /* ×¨×™×¤×•×“ ×¤× ×™××™: 12px ×œ×’×•×‘×” ×•-15px ×œ×¨×•×—×‘ */
  text-align: center;       /* ×™×™×©×•×¨ ×ª×•×›×Ÿ ×œ××¨×›×– */
  min-width: 120px;         /* ×¨×•×—×‘ ××™× ×™××œ×™ ×œ×›×œ ×ª× */
}

.custom-table th {
  background: #f2f2f2;      /* ×¨×§×¢ ××¤×•×¨ ×‘×”×™×¨ ×œ×›×•×ª×¨×•×ª ×”×˜×‘×œ×” */
}

#tableContainer {
  margin: 50px auto;        /* ×¨×•×•×— ×¢×œ×™×•×Ÿ/×ª×—×ª×•×Ÿ ×©×œ 50px ×•××¨×›×•×– ××•×¤×§×™ */
  overflow-x: auto;         /* ×ª××¤×©×¨ ×’×œ×™×œ×” ××•×¤×§×™×ª ×× ×”×˜×‘×œ×” ×¨×—×‘×” ××“×™ */
  padding: 20px 0;          /* ×¨×•×•×— ×¤× ×™××™ ×¢×œ×™×•×Ÿ ×•×ª×—×ª×•×Ÿ ×©×œ 20px */
}

.table-title {
  text-align: center;       /* ×™×™×©×•×¨ ×˜×§×¡×˜ ×œ××¨×›×– */
  font-size: 26px;          /* ×’×•×“×œ ×¤×•× ×˜ ×’×“×•×œ ×œ×›×•×ª×¨×ª */
  font-weight: bold;        /* ×˜×§×¡×˜ ××•×“×’×© */
  color: #333;              /* ×¦×‘×¢ ×˜×§×¡×˜ ×›×”×” */
  padding: 10px 0;          /* ×¨×™×¤×•×“ ×× ×›×™: 10px ×¢×œ×™×•×Ÿ ×•×ª×—×ª×•×Ÿ */
}

.circle-section {
  display: flex;            /* ×”×¦×’×ª ×”××œ×× ×˜×™× ×‘×ª×•×š ×”××—×œ×§×” ×›-flex */
  justify-content: center;  /* ×™×™×©×•×¨ ×ª×•×›×Ÿ ×œ××¨×›×– ×”××•×¤×§×™ */
  padding: 100px 20px;      /* ×¨×™×¤×•×“: 100px ×¢×œ×™×•×Ÿ/×ª×—×ª×•×Ÿ, 20px ×¦×“×“×™× */
}

.circle {
  height: 100px;            /* ×’×•×‘×” ×§×‘×•×¢ ×©×œ ×”××¢×’×œ: 100 ×¤×™×§×¡×œ×™× */
  width: 100px;             /* ×¨×•×—×‘ ×§×‘×•×¢ ×©×œ ×”××¢×’×œ: 100 ×¤×™×§×¡×œ×™× */
  padding: 2px;             /* ×¨×™×¤×•×“ ×¤× ×™××™ ×§×œ ××¡×‘×™×‘ */
}

  </style>
</head>
<body>
  <header>
    <nav class="navbar">
      <div class="logo">
        <img src="images/logo.PNG" alt="×œ×•×’×• ×¡×™××•×œ×˜×•×¨ ×™×¨×™ IoT" class="nav-logo">
      </div>
      <ul class="nav-links">
        <li><a href="index.html">×“×£ ×”×‘×™×ª</a></li>
        <li><a href="about.html">××™×“×¢ ×›×œ×œ×™</a></li>
        <li><a href="gallery.html">×’×œ×¨×™×”</a></li>
        <li><a href="simulation.html">×¡×™××•×œ×¦×™×”</a></li>
        <li><a href="result.html" class="active">×ª×•×¦××•×ª</a></li>
      </ul>
    </nav>
  </header>

  <div class="table-title">ğŸ“Š ×ª×•×¦××•×ª ×”×¡×™××•×œ×¦×™×”</div>
  <div id="tableContainer">
    <!-- ×”×˜×‘×œ×” ×ª×™×•×•×¦×¨ ×›××Ÿ -->
  </div>

  <footer>
    <div class="footer-bottom">
      <p>&copy; 2024 ×¡×™××•×œ×˜×•×¨ ×™×¨×™ IoT</p>
    </div>
  </footer>

  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    sessionStorage.removeItem("data");
    firebase.initializeApp({
      apiKey: "AIzaSyBrBVe45kYSZZWPI8wmMD6PFCHN7di85z8",
      authDomain: "shotingsimulator-a1761.firebaseapp.com",
      projectId: "shotingsimulator-a1761",
      storageBucket: "shotingsimulator-a1761.appspot.com",
      messagingSenderId: "1083902603620",
      appId: "1:1083902603620:web:93e4e9ffc67cf9644bca71"
    });
    let count =  6;
    async function loadSimulationData() {
      try {
        let simulation = JSON.parse(sessionStorage.getItem("data") || "[]");
        let lastSavedBulletCount = Number(sessionStorage.getItem("numofbullets") || 6);
  
        const db = firebase.database().ref("altera1/TX");
        const snapshotB = await db.child("B").get();
        const snapshotA = await db.child("A").get();
        const snapshotC = await db.child("C").get();
  
        const currentnumofbullet = Number(snapshotB.val());
        let numofbullets = currentnumofbullet;
        console.log(currentnumofbullet ,lastSavedBulletCount, count);
        
        if (currentnumofbullet != lastSavedBulletCount ) {
          count = count - 1;
            const newShot = {
            distance: snapshotA.val(),
            hit: snapshotC.val() === "1",
          };
          simulation.push(newShot);
          sessionStorage.setItem("data", JSON.stringify(simulation));
        }
          sessionStorage.setItem("numofbullets", currentnumofbullet.toString());
        
        
        let html = "";
        if(count <= 0){
          firebase.database().ref("altera1/RX").set(0);
          html += '<div class="circle-section"><h2>×ª×•×¦××•×ª:</h2></div>'
        }else{
          html += '<div class="circle-section">'
          for (let i= 0; i < count; i ++){
            html += '<img class="circle" src="./images/bullet.png">'
          }
          html += '</div>'
        }
        
        
        if (simulation.length > 0) {
          html += `
          <table class="custom-table">
            <thead>
              <tr>
                <th>×™×¨×™</th>
                <th>××¨×—×§ ××”××˜×¨×” (×¡×´×)</th>
                <th>×¤×’×™×¢×” ×‘××˜×¨×”</th>
              </tr>
            </thead>
            <tbody>`;
          simulation.forEach((shot, index) => {
            html += `
              <tr>
                <td>${index + 1}</td>
                <td>${shot.distance}</td>
                <td>${shot.hit ? "âœ… ×›×Ÿ" : "âŒ ×œ×"}</td>
              </tr>`;
          }); 
          html += '</tbody></table>';
        }
  

  
        document.getElementById("tableContainer").innerHTML = html;
  
      } catch (error) {
        console.error("×©×’×™××” ×‘×©×œ×™×¤×” ×-Firebase:", error);
        document.getElementById("tableContainer").innerHTML = "<p>×©×’×™××” ×‘×˜×¢×™× ×ª ×”× ×ª×•× ×™×.</p>";
      }
    }
  
    document.addEventListener("DOMContentLoaded", function () {
      loadSimulationData(); 
      setInterval(loadSimulationData, 1000); 
    });
  </script>
  
  
  
</body>
</html>
